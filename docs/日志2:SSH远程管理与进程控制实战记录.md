# 日志2：SSH远程管理与进程控制实战记录

**日期**: 2025年7月15日  
**前置**: 日志1 - AWS EC2 FastAPI部署基础完成  
**目标**: 掌握SSH连接和进程管理的核心技能  
**状态**: ✅ 成功完成

## 📋 学习背景

在完成EC2实例创建和FastAPI基础部署后，需要进一步掌握：

1. SSH终端连接的标准操作方法
2. 进程管理和服务控制技能
3. 后台运行服务的解决方案
4. 理解进程与终端会话的关系

## 🎯 本次学习目标

- [x] 验证SSH连接操作的正确性
- [x] 理解专业主机访问方法的分类
- [x] 掌握进程管理基础技能
- [x] 解决服务后台运行问题
- [x] 建立完整的远程服务管理工作流

## 🛠️ 主机访问方法学习

### 学习路径规划

#### 第一阶段：SSH命令行（已完成）

**目标**: 熟练使用SSH进行服务器管理

**关键技能验证**:

```bash
# SSH连接验证
ssh -i my-ec2-key.pem ec2-user@44.203.54.30

# 密钥权限设置
chmod 600 my-ec2-key.pem

# 基本文件操作
ls -la
cat app.py
```

**学习成果**:

- [x] 能够稳定连接EC2实例
- [x] 正确设置密钥文件权限
- [x] 掌握基本的Linux命令操作
- [x] 验证远程文件访问能力

#### 第二阶段：VS Code Remote（计划中）

**目标**: 实现本地IDE操作远程服务器

**优势分析**:

- 替代scp文件传输的低效方式
- 保持本地开发习惯
- 图形化界面提升效率
- 集成调试和终端功能

#### 第三阶段：AWS Session Manager（企业级）

**概念澄清**:

- **Session Manager**: 连接方式（替代SSH）
- **AWS CLI**: 管理工具（已有Amplify经验可复用）
- **核心优势**: 无密钥管理、审计日志、IAM权限控制

## 🔧 进程管理核心技能

### 问题分析：为什么SSH断开会停止服务？

#### Unix进程关系理解

```text
SSH会话 (父进程)
    └── bash shell (子进程)
        └── uvicorn (孙进程)
```

#### SIGHUP信号机制

```text
关闭SSH → 发送SIGHUP信号 → 终止所有子进程 → uvicorn停止
```

**核心概念**: SIGHUP = "Signal Hang Up"，系统告知进程控制终端断开的信号

### 解决方案对比

#### 方案1：nohup（已实践）

```bash
# 启动命令
nohup uvicorn app:app --host 0.0.0.0 --port 8000 &

# 验证进程
ps aux | grep uvicorn

# 检查运行状态
curl localhost:8000
```

**特点**:

- ✅ 操作简单，一行命令解决
- ✅ 忽略SIGHUP信号，服务持续运行
- ✅ 输出重定向到nohup.out文件
- ❌ 无法重新连接到进程查看实时状态

#### 方案2：screen（推荐进阶）

```bash
# 创建会话
screen -S fastapi

# 启动服务
uvicorn app:app --host 0.0.0.0 --port 8000

# 脱离会话：Ctrl+A, 然后按D
# 重新连接：screen -r fastapi
```

**特点**:

- ✅ 可以重新连接查看实时日志
- ✅ 虚拟终端独立于SSH连接
- ✅ 支持多窗口管理
- ❌ 需要学习screen命令

#### 方案3：systemd（生产级）

```bash
# 创建系统服务
sudo nano /etc/systemd/system/fastapi.service

# 服务管理
sudo systemctl start fastapi
sudo systemctl enable fastapi  # 开机自启
```

**特点**:

- ✅ 最稳定的运行方式
- ✅ 开机自动启动
- ✅ 完整的日志管理
- ❌ 配置相对复杂

## 🚀 实践操作记录

### SSH连接验证成功

**macOS终端操作**:

```bash
# 密钥权限设置
chmod 600 my-ec2-key.pem

# SSH连接
ssh -i my-ec2-key.pem ec2-user@44.203.54.30

# 系统信息确认
Amazon Linux 2023
Last login: Mon Jul 14 11:22:06
```

**验证要点**:

- [x] 密钥文件权限正确设置
- [x] SSH连接建立成功
- [x] 能够查看和操作远程文件
- [x] FastAPI应用文件完整性确认

### nohup后台运行实践

**操作步骤**:

```bash
# 1. 停止前台进程（如果存在）
pkill -f uvicorn

# 2. 后台启动服务
nohup uvicorn app:app --host 0.0.0.0 --port 8000 &

# 3. 验证进程状态
ps aux | grep uvicorn

# 4. 测试服务可用性
curl localhost:8000
curl http://44.203.54.30:8000/

# 5. 关闭SSH连接测试
# 6. 浏览器验证服务持续运行
```

**关键发现**:

- ✅ nohup成功解决SSH断开导致服务停止的问题
- ✅ 服务在SSH会话结束后继续运行
- ✅ 浏览器访问 <http://44.203.54.30:8000/> 正常返回结果
- ✅ 实现了真正的"云服务"效果

## 💡 技术理解深化

### 1. Unix进程管理机制

理解了父子进程关系和信号传递机制，掌握了为什么普通前台进程会随SSH断开而终止。

### 2. 后台运行的本质

学会了通过nohup、screen、systemd等不同方式实现进程与终端会话的解耦。

### 3. 云服务运维思维

从"玩具项目"向"生产服务"的思维转变，服务应该独立于操作者的连接状态。

## 🎯 工作流程建立

### 完整的远程开发流程

```text
1. SSH连接服务器
2. 代码开发/修改（当前：nano，计划：VS Code Remote）
3. 停止旧服务：pkill -f uvicorn
4. 后台启动新服务：nohup uvicorn app:app --host 0.0.0.0 --port 8000 &
5. 验证服务运行：curl测试
6. 断开SSH连接
7. 服务持续运行，提供云端访问
```

### 进程管理常用命令

```bash
# 查看进程
ps aux | grep uvicorn

# 查看端口占用
netstat -tulpn | grep 8000
lsof -i :8000

# 停止进程
pkill -f uvicorn
kill <进程ID>

# 系统资源监控
htop
df -h
free -m
```

## 📚 学习收获总结

### 技术技能提升

- [x] 掌握SSH连接的标准操作流程
- [x] 理解Unix进程管理和信号机制
- [x] 学会使用nohup实现后台服务运行
- [x] 建立完整的远程服务管理工作流

### 运维思维建立

- [x] 理解云服务的独立性要求
- [x] 掌握进程与会话解耦的重要性
- [x] 学会从开发思维向运维思维转变

### 问题解决能力

- [x] 能够分析和解决服务停止问题
- [x] 掌握多种后台运行解决方案
- [x] 具备基础的Linux系统管理能力

## 🚀 下一步学习方向

### 即将探索的技术

1. **VS Code Remote开发**: 提升远程开发效率
2. **screen会话管理**: 更灵活的进程控制
3. **systemd服务配置**: 生产级服务部署
4. **AWS Session Manager**: 企业级安全连接

### 长期技能规划

1. **容器化部署**: Docker + ECS
2. **负载均衡**: ALB配置
3. **数据库集成**: RDS连接
4. **监控告警**: CloudWatch集成

## 🏆 实战成果

通过本次学习，成功实现了：

1. **SSH连接标准化**: 掌握了专业的远程连接方法
2. **进程管理专业化**: 理解了Unix系统的进程控制机制
3. **服务运行持久化**: 解决了SSH断开导致服务停止的问题
4. **云服务思维建立**: 从开发环境向生产环境的思维转换

这标志着从"能部署"向"会管理"的重要跃升，为后续更复杂的云架构学习奠定了坚实的基础。

---

**当前状态**: EC2实例运行稳定，FastAPI服务后台持续运行，可通过 <http://44.203.54.30:8000/> 访问  
**下次目标**: 配置VS Code Remote开发环境，提升远程开发效率
